\documentclass[letterpaper]{article}
\input{../../../preamble.tex}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{fancyhdr}
\usepackage[hidelinks]{hyperref}
\usepackage{pdflscape}

\fancypagestyle{noheader}{
  \fancyhf{}% Clear header/footer
  \renewcommand{\headrulewidth}{0pt}% No header rule
  \rfoot{\thepage}
} 

\pagestyle{fancy}
\fancyhf{}
\rhead{CSE 131}
\chead{Friday, June 02, 2023}
\lhead{Lecture 26}
\rfoot{\thepage}

\setlength{\parindent}{0pt}

\begin{document}

\thispagestyle{noheader}
\newgeometry{left=0.1in,right=0.1in,top=0.2in,bottom=0.5in}
\section{Optimization (Continued)}
\subsection{Flow Analysis}
\subsubsection{Another Flow Analysis Walkthrough}
Consider the following program: 
\begin{verbatim}
    (fun (same_at vec1 vec2 i)
        (= (index vec1 i) (index vec2 i)))\end{verbatim}
We'll perform another flow analysis\footnote{Note that this IR representation was generated by hand.}, again by starting from the beginning and going to the end. The information we'll keep track of are the \emph{potential} tags. Our tags are now slightly more refined; in particular, we now have the set of tags, 
\[\text{tag} := Z | \text{Pos} | \text{Neg} | B | V | \text{Nil}\]
Here, \code{Z} means the number zero, \code{Pos} means positive number, \code{Neg} means negative number. We also have \code{B} for boolean, \code{V} for vector, and \code{Nil} for nil. Once again, we let $A$ represent the set of all possible tags. We also introduce $N = \{Z, \text{Pos}, \text{Neg}\}$ for numbers\footnote{Note that there's no overlaps in this set; we either have negative numbers, positive numbers, and zero.}. 

\begin{center}
    \begin{tabular}{p{2.5in}|p{0.65in}|p{0.65in}|p{1.25in}|p{0.65in}|p{0.65in}|p{0.65in}}
        IR & \code{vec1} & \code{vec2} & \code{i} & $t_0$ & $t_1$ & \code{rax} \\ 
        \hline 
        \verb|start0: check isnonnilvec(vec1)|      & $\to V$ &   &   &   &   &   \\
        \verb|start1: check isnum(i)|               & V &   & $\to N$ &   &   &   \\
        \verb|start2: check i >= 0|                 & V &   & $N \to \{Z, \text{Pos}\}$ &   &   &   \\
        \verb|start3: check i < len(vec1)|          & V &   & $\{Z, \text{Pos}\} \to \{Z, \text{Pos}\}$ &   &   &   \\
        \verb|start4: %t_0 <- vec1[i]|              & V &   & $\{Z, \text{Pos}\}$ & $\to A$ &   &   \\
        \verb|start5: check isnonnilvec(vec2)|      & V & $\to V$ & $\{Z, \text{Pos}\}$ & A &   &   \\
        \verb|start6: check isnum(i)|               & V & V & $\{Z, \text{Pos}\}$ & A &   &   \\
        \verb|start7: check i >= 0|                 & . & . & . & . &   &   \\
        \verb|start8: check i < len(vec2)|          & . & . & . & . &   &   \\
        \verb|start9: %t_1 <- vec2[i]|              & . & . & . & . &   &   \\
        \verb|start10:check sametag(%t_0, %t_1)|    &   &   &   &   &   &   \\
        \verb|start10:rax <- %t_0 == %t_1|          &   &   &   &   &   &   \\
        \verb|return rax|                           &   &   &   &   &   &   \\
    \end{tabular}
\end{center}
Note that, at \code{start7}, at our second pass, we can either reduce this to just checking \code{true}, or just deleting the check altogether.

\subsubsection{Abstract Domains}
We're now incorporating forward analysis with some numeric range analysis. We can call these types of analysis abstract domains. We have seen three different abstract domains for analysis: 
\begin{itemize}
    \item \code{Set<String>} for liveliness analysis (for register allocation).
    \item \code{Dict<String, Set<Tag>>} for forward data analysis. 
\end{itemize}
There were two different types of tags: 
\begin{itemize}
    \item \code{Z | P | N}: information about numbers (positive, negative, etc.)
    \item \code{N | B | Nil | P}: other relevant tag information.
\end{itemize}
How do we unify these domains? We can consider ideas like: 
\begin{itemize}
    \item Frequency for variable use.
    \item Frequency of branches. 
    \item Ranges of numbers. 
    \item Booleans as true or false.
    \item Lengths of vectors (if we have constants, e.g., setting the tag to be the length of the vector).
\end{itemize}


\end{document}